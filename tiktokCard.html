<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadTikToks();
    });

    function loadTikToks() {
        const tiktokVideos = [
            { url: "https://www.tiktok.com/@fortunetown/video/7569139777002278164" },
            { url: "https://www.tiktok.com/@fortunetown/video/7567275603724881172" },
            { url: "https://www.tiktok.com/@fortunetown/video/7389926371209874705" },
            { url: "https://www.tiktok.com/@fortunetown/video/7441911413834042642" },
            { url: "https://www.tiktok.com/@fortunetown/video/7334931950454590721" },
            { url: "https://www.tiktok.com/@fortunetown/video/7538006429727247624" },
            { url: "https://www.tiktok.com/@fortunetown/video/7563164262986763541" },

        ];

        const thumbnail = "https://cdn.prod.website-files.com/6230cce907f5a55f9a4b0e6f/6230cce907f5a50b984b1855_tiktok1.PNG";

        const container = document.getElementById('phones-container-1732849301');
        const dotsContainer = document.getElementById('dots-container');
        const prevBtn = document.querySelector('.prev-btn-1732849301');
        const nextBtn = document.querySelector('.next-btn-1732849301');

        // Render TikTok videos with embeds
        container.innerHTML = tiktokVideos.map((video, index) => {
            const videoId = video.url.split('?')[0].split('/').pop();
            const embedUrl = `https://www.tiktok.com/embed/v2/${videoId}`;

            return `
                <div class="phone-1732849301" data-position="${index + 1}">
                    <div class="click-overlay-1732849301"></div>
                    <div class="phone-content-1732849301">
                        <img src="${thumbnail}" 
                             alt="TikTok Preview" 
                             class="video-thumbnail-1732849301" 
                             id="thumb-1732849301-${index}">
                        
                        <div class="tiktok-embed-container-1732849301">
                            <iframe 
                                id="tiktok-iframe-${videoId}"
                                src="${embedUrl}"
                                allowfullscreen
                                scrolling="no"
                                allow="encrypted-media; picture-in-picture; autoplay;"
                                sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
                                style="width:100%;height:100%;border:none;">
                            </iframe>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        // Render dots
        dotsContainer.innerHTML = tiktokVideos.map((_, index) =>
            `<span class="dot-1732849301 ${index === 2 ? 'active-1732849301' : ''}" data-index="${index}"></span>`
        ).join('');

        // Auto-remove thumbnails after videos load
        setTimeout(() => {
            const allThumbnails = document.querySelectorAll('.video-thumbnail-1732849301');
            allThumbnails.forEach(thumb => {
                thumb.classList.add('thumbnail-fade-out-1732849301');
                setTimeout(() => {
                    thumb.style.display = 'none';
                }, 800);
            });
        }, 3000); // Wait 3 seconds for iframes to start loading

        // Also listen for iframe load events to remove thumbnails earlier if possible
        const iframes = document.querySelectorAll('[id^="tiktok-iframe-"]');
        let loadedCount = 0;
        iframes.forEach(iframe => {
            iframe.addEventListener('load', () => {
                loadedCount++;
                // If at least one iframe loaded, start fading thumbnails
                if (loadedCount === 1) {
                    const allThumbnails = document.querySelectorAll('.video-thumbnail-1732849301');
                    allThumbnails.forEach(thumb => {
                        thumb.classList.add('thumbnail-fade-out-1732849301');
                        setTimeout(() => {
                            thumb.style.display = 'none';
                        }, 800);
                    });
                }
            });
        });

        const phones = document.querySelectorAll('.phone-1732849301');
        const dots = document.querySelectorAll('.dot-1732849301');
        const totalPhones = phones.length;

        let currentCenter = 2;

        function updatePositions() {
            phones.forEach((phone, index) => {
                const offset = index - currentCenter;
                const position = 3 + offset;

                phone.setAttribute('data-position', position);

                if (position < 1 || position > 5) {
                    phone.style.display = 'none';
                } else {
                    phone.style.display = 'block';
                }
            });

            dots.forEach((dot, index) => {
                dot.classList.toggle('active-1732849301', index === currentCenter);
            });

            prevBtn.disabled = currentCenter === 0;
            nextBtn.disabled = currentCenter === totalPhones - 1;
        }

        function slideNext() {
            if (currentCenter < totalPhones - 1) {
                currentCenter++;
                updatePositions();
            }
        }

        function slidePrev() {
            if (currentCenter > 0) {
                currentCenter--;
                updatePositions();
            }
        }

        let isAnimating = false;

        function goToSlide(targetIndex) {
            if (isAnimating) return;

            isAnimating = true;
            const direction = targetIndex > currentCenter ? 1 : -1;
            const steps = Math.abs(targetIndex - currentCenter);
            let stepCount = 0;

            function animateStep() {
                if (stepCount < steps) {
                    currentCenter += direction;
                    updatePositions();
                    stepCount++;
                    setTimeout(animateStep, 300);
                } else {
                    isAnimating = false;
                }
            }

            animateStep();
        }

        nextBtn.addEventListener('click', slideNext);
        prevBtn.addEventListener('click', slidePrev);

        dots.forEach((dot) => {
            dot.addEventListener('click', function () {
                const index = parseInt(this.getAttribute('data-index'));
                if (!isNaN(index)) {
                    goToSlide(index);
                }
            });
        });

        phones.forEach((phone, index) => {
            phone.addEventListener('click', function () {
                if (index !== currentCenter) {
                    goToSlide(index);
                }
            });
        });

        // Touch swipe support 
        let touchStartX = 0;
        let touchEndX = 0;

        container.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        container.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            const diff = touchStartX - touchEndX;
            const swipeThreshold = 50;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    slideNext();
                } else {
                    slidePrev();
                }
            }
        });

        updatePositions();
    }
</script>

<div class="container-1732849301">
    <h1 class="title-1732849301">รีวิวผลิตภัณฑ์จากผู้ใช้จริง</h1>
    <div class="carousel-wrapper-1732849301">
        <button class="nav-btn-1732849301 prev-btn-1732849301" aria-label="Previous">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>
        <div class="phones-container-1732849301" id="phones-container-1732849301">
            <!-- tiktok card will show here -->
        </div>
        <button class="nav-btn-1732849301 next-btn-1732849301" aria-label="Next">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
    </div>
    <div class="dots-1732849301" id="dots-container"></div>
</div>

<style>
    :root {
        --bg-color-1732849301: #f5f5f0;
        --text-dark-1732849301: #4a4a4a;
        --dot-inactive-1732849301: #d4d4d4;
        --dot-active-1732849301: #9cc4d9;
        --phone-bg-1732849301: #6b6b5e;
    }

    .container-1732849301 {
        max-width: 1400px;
        width: 100%;
        padding: 50px 0;
        margin: 0 auto;
    }

    .title-1732849301 {
        text-align: center;
        font-size: 28px;
        font-weight: 500;
        color: var(--text-dark-1732849301);
        margin-bottom: 50px;
        letter-spacing: 0.5px;
    }

    .carousel-wrapper-1732849301 {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        margin-bottom: 40px;
    }

    .nav-btn-1732849301 {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-dark-1732849301);
        flex-shrink: 0;
        z-index: 10;
    }

    .nav-btn-1732849301:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .phones-container-1732849301 {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
        position: relative;
        min-height: 550px;
        perspective: 1200px;
        overflow: visible;
        flex: 1;
    }

    .phone-1732849301 {
        width: 325px;
        height: 570px;
        background: #000;
        padding: 0;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        position: absolute;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        overflow: hidden;
        will-change: transform;
        border-radius: 20px;
    }

    .phone-1732849301[data-position="1"] {
        transform: translateX(-35rem) scale(0.75);
        z-index: 1;
        opacity: 0.6;
    }

    .phone-1732849301[data-position="2"] {
        transform: translateX(-20rem) scale(0.85);
        z-index: 2;
        opacity: 0.8;
    }

    .phone-1732849301[data-position="3"] {
        transform: translateX(0) scale(1);
        z-index: 3;
        opacity: 1;
    }

    .phone-1732849301[data-position="4"] {
        transform: translateX(20rem) scale(0.85);
        z-index: 2;
        opacity: 0.8;
    }

    .phone-1732849301[data-position="5"] {
        transform: translateX(35rem) scale(0.75);
        z-index: 1;
        opacity: 0.6;
    }

    .click-overlay-1732849301 {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        cursor: pointer;
    }

    .phone-1732849301[data-position="3"] .click-overlay-1732849301 {
        display: none;
    }

    .phone-content-1732849301 {
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: relative;
        background: #000;
        border-radius: 0;
    }

    .video-thumbnail-1732849301 {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 10;
        transition: opacity 0.8s ease-out;
        pointer-events: none;
    }

    .thumbnail-fade-out-1732849301 {
        opacity: 0;
    }

    .tiktok-embed-container-1732849301 {
        width: 100%;
        height: 100%;
        background: #000;
        position: relative;
    }

    .dots-1732849301 {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .dot-1732849301 {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: var(--dot-inactive-1732849301);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .dot-1732849301.active-1732849301 {
        background-color: var(--dot-active-1732849301);
        transform: scale(1.3);
    }

    @media (max-width: 1200px) {
        .phones-container-1732849301 {
            min-height: 450px;
            gap: 30px;
        }

        .phone-1732849301 {
            width: 200px;
            height: 400px;
        }

        .phone-1732849301[data-position="1"] {
            transform: translateX(-340px) scale(0.75);
        }

        .phone-1732849301[data-position="2"] {
            transform: translateX(-200px) scale(0.85);
        }

        .phone-1732849301[data-position="4"] {
            transform: translateX(200px) scale(0.85);
        }

        .phone-1732849301[data-position="5"] {
            transform: translateX(340px) scale(0.75);
        }
    }

    @media (max-width: 768px) {
        .title-1732849301 {
            font-size: 22px;
            margin-bottom: 30px;
        }

        .carousel-wrapper-1732849301 {
            gap: 15px;
        }

        .nav-btn-1732849301 {
            width: 40px;
            height: 40px;
        }

        .nav-btn-1732849301 svg {
            width: 18px;
            height: 18px;
        }

        .phones-container-1732849301 {
            min-height: 350px;
            gap: 25px;
        }

        .phone-1732849301 {
            width: 160px;
            height: 320px;
        }

        .phone-1732849301[data-position="1"] {
            transform: translateX(-260px) scale(0.7);
        }

        .phone-1732849301[data-position="2"] {
            transform: translateX(-155px) scale(0.85);
        }

        .phone-1732849301[data-position="4"] {
            transform: translateX(155px) scale(0.85);
        }

        .phone-1732849301[data-position="5"] {
            transform: translateX(260px) scale(0.7);
        }
    }

    @media (max-width: 480px) {
        .carousel-wrapper-1732849301 {
            flex-direction: column;
            gap: 20px;
        }

        .nav-btn-1732849301 {
            position: relative;
        }

        .phones-container-1732849301 {
            min-height: 500px;
            width: 100%;
        }

        .phone-1732849301 {
            width: 240px;
            height: 480px;
        }

        .phone-1732849301[data-position="1"],
        .phone-1732849301[data-position="2"],
        .phone-1732849301[data-position="3"],
        .phone-1732849301[data-position="4"],
        .phone-1732849301[data-position="5"] {
            transform: translateX(0) scale(1);
            opacity: 0;
            pointer-events: none;
        }

        .phone-1732849301[data-position="3"] {
            opacity: 1;
            pointer-events: auto;
        }
    }
</style>